---
layout: post
title: Iglu R8 Basel Dove released
title-short: Iglu R8 Basel Dove
tags: [iglu, json, json schema, redshift]
author: Oguzhan
category: Releases
permalink: /blog/2018/02/02/iglu-r8-basel-dove-released/
---

We are excited to announce a new Iglu release, introducing a good number of improvements focused on igluctl.

1. [Switch from severity levels to granular linting](#skip-checks)
2. [Dealing with inconsistent schema versions](#missing-schema-versions)
3. [ZSTD compression support][#zstd]
4. [New linters](#new-linters)
5. [Setting owner of Redshift tables](#set-owner)
6. [Other updates](#other-updates)
7. [Getting Help](#help)

Read on for more information on Release 8 Basel Dove, named after [a Swiss postage stamp][basel-dove], the first tricolor stamp in the world.

![basel-dove-img][basel-dove-img]

<!--more-->

<h2 id="skip-checks">1. Switch from severity levels to granular linting</h2>

In [igluctl 0.2.0][iglu-r6-release] we introduced the concept of linting severity levels, which was intended to make some schemas to meet higher standards than others.
However, time has shown that different schema use cases imply different idea of higher standard and our inital approach lacks flexibility required to cover all these use cases.

With new approach, igluctl always defaults to highest possible standard (previosly known as `serverityLevel 3`), which however can be explicitly loosened in order to pass linting.
This way igluctl allows users to make sure they didn't forget to switch to higher levels.
If some checks can be omitted - they need to be omitted explicitly.

To weaken linting, `--skip-checks` option should be used. It accepts list of comma-separated predefined linter names, for example:

{% highlight bash %}
$ igluctl lint --skip-checks optionalFields,descriptionPresent $SCHEMAS_PATH
{% endhighlight %}

Above linting will not notify user that some fields miss `description` property and other fields are implicitly optional (`null` type makes them explitly optional).

Full list of available checks, their descriptions and use cases are available on [igluctl wiki page][igluctl-lint].

<h2 id="missing-schema-versions">2. Dealing with inconsistent schema versions</h2>

All schemas on Iglu Registries within single MODEL suppose to have a particular relation to each other and this relation is very important for proper DDL derivation, especially when it comes to column-oriented storages such as Amazon Redshift.
In other words, to generate proper non-breaking Redshift DDL, igluctl must be aware of all previously available source schemas.

Until Basel Dove it was possible to simply specify folder with only `1-0-1` schema in it and `static generate` would output DDL file assuming that this is the initial and single available schemas.
At the saime time if the initial and "lost" `1-0-0` schema didn't have some new columns added in `1-0-1` - these new columns will be mixed into the middle of DDL, effectively making DDL corrupted and migration impossible.

Starting from Basel Dove, it is almost impossible to generate this corrupted DDL by mistake.
New igluctl adds following additional checks and associated alerts to prevent it:

* If user specified folder as input and among schemas there's no 1-0-0 or any other schemas in between - refuse to do anything (but proceed with `--force` option at your own risk)
* If user specified full path to file with schema and this file is not 1-0-0 - just print a warning
* In all other cases - proceed as usual

This also can be considered as one more step towards consistent registries and therefore proper DDL migrations.

<h2 id="zstd">3. ZSTD compression support</h2>

In [Snowplow R95 Ellora][snowplow-r95] we migrated our [atomic.events][atomic-events] table to much anticipated [ZSTD encoding][zstd], which had big positive impact on used storage space.

As of Basel Dove, ZSTD is now also default encoding in DDL files generated by igluctl, thanks to [Mike Robbins][miike] of Snowflake Analytics, who drives whole ZSTD effort in Snowplow stack.

There's no special configuration required, all existing table with LZO encoding will work as expected.
However, please note that if you want to migrate existing tables to ZSTD you will have to write and execute these migration script yourself.
Example `atomic.events` migration can be found in [snowplow repository][atomic-events-migration].

<h2 id="new-linters">4. New linters</h2>

Some more work has been done in igluctl 0.4.0 to improve litning mechanism, particularly following new linters were added.

<h3 id="missing-linter">4.1 Linting missing schema versions</h3>

Beside already mentioned warnings in `static generate` command, `lint` command will now also warn about missing schema versions.
This new linting feature is considered and can not be excluded through `--skip-checks`.

<h3 id="description-linter-2">4.2 Linting description</h3>

[Mike Robbins][miike] of Snowflake Analytics came up with the proposal and PR for making sure fields have a human-readable `description` property in order to make schemas more maintainable.
Huge thanks, Mike!

<h2 id="set-owner">5. Setting owner of Redshift tables</h2>

It is frequently forgotten to set owner of Redshift tables after generating DDLs.
With this release, we are introducing `--set-owner` parameter to igluctl's `static generate` command. 
It is provided with a string and igluctl will append an `ALTER TABLE` statement at the end of DDL, making sure that owner is always present.

<h2 id="other-updates">6. Other updates</h2>

Basel Dove brings few small adjustments too.

Header part of DDLs contain an auto-generated comment section with project related information. As of now, it will also contain when that DDL was generated in UTC, instead of local time.

Basel Dove also fixes [an important bug][issue-313] in igluctl, which could generate false failure messages even though `static push` command executed successfully.

<h2 id="help">7. Getting help</h2>

For more details on this release, as always do check out the [release notes][snowplow-release] on GitHub.

If you have any questions or run into any problems, please visit [our Discourse forum][discourse].

[iglu-release]: https://github.com/snowplow/iglu/releases/r8-basel-dove
[discourse]: http://discourse.snowplowanalytics.com/
[changelog]: https://github.com/snowplow/iglu/blob/master/CHANGELOG

[basel-dove]: https://en.wikipedia.org/wiki/Basel_Dove
[basel-dove-img]: /assets/img/blog/2018/01/Basel_Dove.jpg
[zstd]: https://docs.aws.amazon.com/redshift/latest/dg/zstd-encoding.html

[snowplow-r95]: https://snowplowanalytics.com/blog/2017/11/13/snowplow-r95-ellora-released-with-zstd-support/
[atomic-events]: https://github.com/snowplow/snowplow/blob/master/4-storage/redshift-storage/sql/atomic-def.sql
[atomic-events-migration]: https://github.com/snowplow/snowplow/blob/master/4-storage/redshift-storage/sql/migrate_0.8.0_to_0.9.0.sql

[iglu-r6-release]: https://snowplowanalytics.com/blog/2016/10/07/iglu-r6-ceres-released/#severity
[igluctl-lint]: https://github.com/snowplow/iglu/wiki/Igluctl#lint

[miike]: https://github.com/miike

[issue-313]: https://github.com/snowplow/iglu/issues/313
